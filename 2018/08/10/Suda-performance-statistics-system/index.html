<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Suda,"><meta name="description" content="正在学习会长的suda框架，努力成为一个优秀的开发狗"><meta name="keywords" content="Suda"><meta property="og:type" content="article"><meta property="og:title" content="记一次suda框架之简单成绩系统"><meta property="og:url" content="http://www.mobenw.com/2018/08/10/Suda-performance-statistics-system/index.html"><meta property="og:site_name" content="MoBenw"><meta property="og:description" content="正在学习会长的suda框架，努力成为一个优秀的开发狗"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://www.mobenw.com/2018/08/10/Suda-performance-statistics-system/2018/08/10/Suda-performance-statistics-system/0.png"><meta property="og:updated_time" content="2018-09-04T09:55:02.080Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="记一次suda框架之简单成绩系统"><meta name="twitter:description" content="正在学习会长的suda框架，努力成为一个优秀的开发狗"><meta name="twitter:image" content="http://www.mobenw.com/2018/08/10/Suda-performance-statistics-system/2018/08/10/Suda-performance-statistics-system/0.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"0WGKTU8P2U",apiKey:"3a7db1e65976d82c8bb18e2853de726e",indexName:"mobenw",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.mobenw.com/2018/08/10/Suda-performance-statistics-system/"><title>记一次suda框架之简单成绩系统 | MoBenw</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b8b7d27fcb70fd3039db26232cdc20c3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/MoBenw" class="github-corner" aria-label="View source on Github"><svg width="120" height="120" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">MoBenw</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.mobenw.com/2018/08/10/Suda-performance-statistics-system/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="MoBenw"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="MoBenw"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">记一次suda框架之简单成绩系统</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-10T23:05:13+08:00">2018-08-10</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Suda框架学习/" itemprop="url" rel="index"><span itemprop="name">Suda框架学习</span></a></span></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-eye"></i> Visitors<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2,865</span></div><div class="post-description"> 正在学习会长的suda框架，努力成为一个优秀的开发狗</div></div></header><div class="post-body" itemprop="articleBody"><div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery"><div class="post-gallery-row"> <a class="post-gallery-img fancybox" href="/2018/08/10/Suda-performance-statistics-system/0.png" rel="gallery_cjnwr3n5x0021vcr8zy08by5l" itemscope itemtype="http://schema.org/ImageObject" itemprop="url"><img src="/2018/08/10/Suda-performance-statistics-system/0.png" itemprop="contentUrl"></a></div></div><a id="more"></a><hr><h3 id="创建一个项目"><a href="#创建一个项目" class="headerlink" title="创建一个项目"></a>创建一个项目</h3><p>作为一个萌新 对创建一个新项目后 对项目的结构可能会有所陌生 不知道该有什么</p><p>所以这里可以复制之前的项目 简单的说就是复制一个<code>app</code>文件夹 然后改名为<code>statistical</code></p><p>关于里面的内容</p><blockquote><p><code>./resoure</code> 目录下</p><blockquote><p><code>./config/router.json</code> # 路由文件内容当然要清理<br><code>./template/defalut/</code> # 因为你需要新写入模板 所以该目录下的模板建议删了</p></blockquote></blockquote><blockquote><p><code>./share</code> 目录下</p><blockquote><p><code>./table/</code> #库文件 因为你可能不适用这些 所以删了</p></blockquote></blockquote><blockquote><p><code>./src</code> 目录下</p><blockquote><p><code>./</code> #响应文件 差不多是与模板对应的 所以删了</p></blockquote></blockquote><blockquote><p><code>./module.json</code> #模板的配置文件 所以内筒清理</p></blockquote><p>关于data文件 data是自动生成的 所以 为了防止之前执行的东东 影响本次 所以 删了</p><p>目录结构</p><p><img src="/2018/08/10/Suda-performance-statistics-system/1.png" alt="123"></p><p>ps.为啥这里我不适用那个高逼格的制表符 是因为没用过 不会用…</p><p><strong>大佬语录</strong></p><blockquote><p>template 下的是模板文件<br>src的文件是页面响应文件<br>share的文件是库文件</p></blockquote><h3 id="设置配置文件"><a href="#设置配置文件" class="headerlink" title="设置配置文件"></a>设置配置文件</h3><h4 id="模板配置-module-json"><a href="#模板配置-module-json" class="headerlink" title="模板配置 module.json"></a>模板配置 <strong>module.json</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dxkite/statistical"</span>,</span><br><span class="line">    <span class="attr">"namespace"</span>: <span class="string">"dxkite/statistical"</span>,</span><br><span class="line">    <span class="attr">"authors"</span>: [&#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dxkite"</span>,</span><br><span class="line">        <span class="attr">"email"</span>: <span class="string">"dxkite@qq.com"</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">"import"</span>: &#123;</span><br><span class="line">        <span class="attr">"share"</span>: &#123;</span><br><span class="line">            <span class="attr">"dxkite\\statistical"</span>: <span class="string">"share"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"src"</span>: &#123;</span><br><span class="line">            <span class="attr">"dxkite\\statistical\\response"</span>: <span class="string">"src"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"discription"</span>: <span class="string">"DXkite的成绩统计模块"</span>,</span><br><span class="line">    <span class="attr">"require"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"1.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="启用模块-manifast-json"><a href="#启用模块-manifast-json" class="headerlink" title="启用模块 manifast.json"></a>启用模块 <strong>manifast.json</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dxkite-statistical-app"</span>,</span><br><span class="line">    <span class="attr">"namespace"</span>: <span class="string">"dxkite\\statistical"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"1.0-dev"</span>,</span><br><span class="line">    <span class="attr">"application"</span>: <span class="string">"suda\\core\\Application"</span>,</span><br><span class="line">    <span class="attr">"modules"</span>: [<span class="string">"suda"</span>, <span class="string">"statistical"</span>],</span><br><span class="line">    <span class="attr">"reachable"</span>: [<span class="string">"statistical"</span>],</span><br><span class="line">    <span class="attr">"language"</span>: <span class="string">"zh-CN"</span>,</span><br><span class="line">    <span class="attr">"url"</span>: &#123;</span><br><span class="line">        <span class="attr">"mode"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"beautify"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"rewrite"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="表单配置-statistic-json"><a href="#表单配置-statistic-json" class="headerlink" title="表单配置 statistic.json"></a>表单配置 <strong>statistic.json</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"table_id_1"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"学生XXX统计表"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: &#123;</span><br><span class="line">            <span class="attr">"math"</span>: &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"数学成绩"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"number"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"english"</span>: &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"英语成绩"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"number"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"table_id_2"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"学生XXX统计表-2"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: &#123;</span><br><span class="line">            <span class="attr">"math"</span>: &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"数学成绩"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"number"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"english"</span>: &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"英语成绩"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"number"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="路由配置-router-json"><a href="#路由配置-router-json" class="headerlink" title="路由配置 router.json"></a>路由配置 <strong>router.json</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"index"</span>: &#123;</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"\/"</span>,</span><br><span class="line">        <span class="attr">"class"</span>: <span class="string">"dxkite\\statistical\\response\\IndexResponse"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"table"</span>: &#123;</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"\/&#123;table_id:string&#125;"</span>,</span><br><span class="line">        <span class="attr">"class"</span>: <span class="string">"dxkite\\statistical\\response\\TableResponse"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"download"</span>: &#123;</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"\/&#123;table_id:string&#125;\/download"</span>,</span><br><span class="line">        <span class="attr">"class"</span>: <span class="string">"dxkite\\statistical\\response\\DownloadResponse"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>案例分析请移步 会长文章</p><h3 id="模板及响应文件"><a href="#模板及响应文件" class="headerlink" title="模板及响应文件"></a>模板及响应文件</h3><h4 id="StatisticTable-php"><a href="#StatisticTable-php" class="headerlink" title="StatisticTable.php"></a><strong>StatisticTable.php</strong></h4><p>这是放在 <code>./share/table</code> 目录下的 相当于库文件吧</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">table</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StatisticTable</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">archive</span>\<span class="title">Table</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 数据表名</span></span><br><span class="line">        <span class="keyword">parent</span>::__construct(<span class="string">'statistic'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">onBuildCreator</span><span class="params">($table)</span></span>&#123;</span><br><span class="line">        $table-&gt;fields(</span><br><span class="line">            $table-&gt;field(<span class="string">'id'</span>,<span class="string">'bigint'</span>,<span class="number">20</span>)-&gt;primary()-&gt;auto()-&gt;comment(<span class="string">'自动增长ID'</span>),</span><br><span class="line">            $table-&gt;field(<span class="string">'student_id'</span>,<span class="string">'varchar'</span>,<span class="number">80</span>)-&gt;key()-&gt;comment(<span class="string">'学号'</span>),</span><br><span class="line">            $table-&gt;field(<span class="string">'table_id'</span>,<span class="string">'varchar'</span>,<span class="number">80</span>)-&gt;key()-&gt;comment(<span class="string">'姓名'</span>),</span><br><span class="line">            $table-&gt;field(<span class="string">'name'</span>,<span class="string">'varchar'</span>,<span class="number">80</span>),</span><br><span class="line">            $table-&gt;field(<span class="string">'data'</span>,<span class="string">'text'</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> $table;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_inputDataField</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">_outputDataField</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unserialize($data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-tpl-html"><a href="#index-tpl-html" class="headerlink" title="index.tpl.html"></a><strong>index.tpl.html</strong></h4><p>你可能需要一个index<br><img src="/2018/08/10/Suda-performance-statistics-system/2.png" alt="index界面"></p><p>这个界面可以自己制作<br>一个<code>&lt;table&gt;</code><br>需要注意的地方就是 url的生成方式</p><p><img src="/2018/08/10/Suda-performance-statistics-system/3.png" alt="注意点"></p><p>也可以参考我的</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Index - 备选表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                ID</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                名称</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                操作</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                table_id_1</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                学生XXX统计表</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"@u('table', 'table_id_1' )"</span>&gt;</span>填写<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"@u('download','table_id_1')"</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                table_id_2</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                学生XXX统计表-2</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"@u('table', 'table_id_2' )"</span>&gt;</span>填写<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"@u('download','table_id_2')"</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="TableResponse-php-amp-amp-table-tpl-html"><a href="#TableResponse-php-amp-amp-table-tpl-html" class="headerlink" title="TableResponse.php &amp;&amp; table.tpl.html"></a><strong>TableResponse.php &amp;&amp; table.tpl.html</strong></h4><p>下面的这个代码 的作用是 你在url里输入什么 他就会返回什么 纯属好玩 给你玩玩的</p><p>应该放在 index之前的 因为index弄好后会有连接 难免会手痒点两下</p><h5 id="TableResponse-php"><a href="#TableResponse-php" class="headerlink" title="TableResponse.php"></a><strong>TableResponse.php</strong></h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $request-&gt;get(<span class="string">'table_id'</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="table-tpl-html"><a href="#table-tpl-html" class="headerlink" title="table.tpl.html"></a><strong>table.tpl.html</strong></h5><p>table的模板设计<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;$:name&#125;&#125; - 填写表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;$:name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"@u"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>学号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"number"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        @foreach ($:fields as $id =&gt; $field) </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123;$field['name']&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                @if ($field['type'] == 'text')</span><br><span class="line">                    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"data[&#123;&#123;$id&#125;&#125;]"</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"10"</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                @elseif ($field['type'] == 'number')</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">name</span>=<span class="string">"data[&#123;&#123;$id&#125;&#125;]"</span> <span class="attr">required</span>&gt;</span> </span><br><span class="line">                @else</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"data[&#123;&#123;$id&#125;&#125;]"</span> <span class="attr">required</span>&gt;</span> </span><br><span class="line">                @endif</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">         @endforeach</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h5 id="TableResponse-php-1"><a href="#TableResponse-php-1" class="headerlink" title="TableResponse.php"></a><strong>TableResponse.php</strong></h5><p>完善过后一次的响应文件<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        $tables = app()-&gt;getModuleConfig(app()-&gt;getFileModule(<span class="keyword">__FILE__</span>), <span class="string">'statistic'</span>);</span><br><span class="line">        $tableId = $request-&gt;get(<span class="string">'table_id'</span>);</span><br><span class="line">        <span class="comment">// 判断是否存在ID</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId])) &#123;</span><br><span class="line">            $view = <span class="keyword">$this</span>-&gt;page(<span class="string">'table'</span>);</span><br><span class="line">            $view-&gt;set(<span class="string">'fields'</span>,$tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">            $view-&gt;set(<span class="string">'name'</span>,$tables[$tableId][<span class="string">'name'</span>]);</span><br><span class="line">            $view-&gt;render();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 显示404界面</span></span><br><span class="line">            hook()-&gt;exec(<span class="string">'system:404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h5 id="TableResponse-php-2"><a href="#TableResponse-php-2" class="headerlink" title="TableResponse.php"></a><strong>TableResponse.php</strong></h5><p>再次升级 新增写入数据<br>你可能需要一个<code>state.tpl.html</code>后面有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $tables = app()-&gt;getModuleConfig(app()-&gt;getFileModule(<span class="keyword">__FILE__</span>), <span class="string">'statistic'</span>);</span><br><span class="line">        $tableId = $request-&gt;get(<span class="string">'table_id'</span>);</span><br><span class="line">        <span class="comment">// 判断是否存在ID</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId])) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($request-&gt;hasPost()) &#123;</span><br><span class="line">                <span class="comment">// 显示结果页面</span></span><br><span class="line">                $view = <span class="keyword">$this</span>-&gt;page(<span class="string">'state'</span>);</span><br><span class="line">                <span class="keyword">if</span> ($type = <span class="keyword">$this</span>-&gt;insertData($tableId, $request)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ($type == <span class="number">1</span>) &#123;</span><br><span class="line">                        $view-&gt;set(<span class="string">'message'</span>,<span class="string">'写入成功'</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        $view-&gt;set(<span class="string">'message'</span>,<span class="string">'数据未更新'</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $view-&gt;set(<span class="string">'message'</span>,<span class="string">'写入失败'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $view-&gt;render();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $view = <span class="keyword">$this</span>-&gt;page(<span class="string">'table'</span>);</span><br><span class="line">                $view-&gt;set(<span class="string">'fields'</span>, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">                $view-&gt;set(<span class="string">'name'</span>, $tables[$tableId][<span class="string">'name'</span>]);</span><br><span class="line">                $view-&gt;render();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 显示404界面</span></span><br><span class="line">            hook()-&gt;exec(<span class="string">'system:404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insertData</span><span class="params">(string $tableId, Request $request)</span>: <span class="title">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $table = <span class="keyword">new</span> \dxkite\statistical\table\StatisticTable;</span><br><span class="line">        <span class="keyword">if</span> ($request-&gt;post(<span class="string">'name'</span>, <span class="keyword">null</span>) &amp;&amp; $request-&gt;post(<span class="string">'number'</span>, <span class="keyword">null</span>) &amp;&amp; $request-&gt;post(<span class="string">'data'</span>, <span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="comment">// 查询条件</span></span><br><span class="line">            $where = [</span><br><span class="line">                <span class="string">'table_id'</span> =&gt; $tableId,</span><br><span class="line">                <span class="string">'student_id'</span> =&gt; $request-&gt;post(<span class="string">'number'</span>)</span><br><span class="line">            ];</span><br><span class="line">            <span class="comment">// 如果存在学号相同，则更新记录</span></span><br><span class="line">            <span class="comment">// 根据ID更新会更快</span></span><br><span class="line">            <span class="keyword">if</span> ($data = $table-&gt;select([<span class="string">'id'</span>],$where)-&gt;fetch()) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($table-&gt;updateByPrimaryKey($data[<span class="string">'id'</span>], [</span><br><span class="line">                    <span class="string">'name'</span> =&gt; $request-&gt;post(<span class="string">'name'</span>),</span><br><span class="line">                    <span class="string">'data'</span> =&gt; $request-&gt;post(<span class="string">'data'</span>)</span><br><span class="line">                ])) &#123;</span><br><span class="line">                    <span class="comment">// 更新成功</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 未跟新</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 插入新记录</span></span><br><span class="line">                $id = $table-&gt;insert([</span><br><span class="line">                    <span class="string">'table_id'</span> =&gt; $tableId,</span><br><span class="line">                    <span class="string">'student_id'</span> =&gt; $request-&gt;post(<span class="string">'number'</span>),</span><br><span class="line">                    <span class="string">'name'</span> =&gt; $request-&gt;post(<span class="string">'name'</span>),</span><br><span class="line">                    <span class="string">'data'</span> =&gt; $request-&gt;post(<span class="string">'data'</span>),</span><br><span class="line">                ]);</span><br><span class="line">                <span class="keyword">if</span> ($id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DownloadResponse-php"><a href="#DownloadResponse-php" class="headerlink" title="DownloadResponse.php"></a><strong>DownloadResponse.php</strong></h4><p>下载有两个版本</p><h5 id="非密码版本"><a href="#非密码版本" class="headerlink" title="非密码版本"></a>非密码版本</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $tables = app()-&gt;getModuleConfig(app()-&gt;getFileModule(<span class="keyword">__FILE__</span>), <span class="string">'statistic'</span>);</span><br><span class="line">        $tableId = $request-&gt;get(<span class="string">'table_id'</span>);</span><br><span class="line">        <span class="comment">// 判断是否存在ID</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId])) &#123;</span><br><span class="line">            $data = <span class="keyword">$this</span>-&gt;exportData($tableId, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">            <span class="comment">// 暂存文件</span></span><br><span class="line">            $path = RUNTIME_DIR .<span class="string">'/'</span>. $tableId .<span class="string">'.csv'</span>;</span><br><span class="line">            storage()-&gt;put($path,$data);</span><br><span class="line">            <span class="comment">// 生成文件下载</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file($path);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 显示404界面</span></span><br><span class="line">            hook()-&gt;exec(<span class="string">'system:404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exportData</span><span class="params">(string $tableId, array $fields)</span>: <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $table = <span class="keyword">new</span> \dxkite\statistical\table\StatisticTable;</span><br><span class="line">        <span class="comment">// 列出同一个表格</span></span><br><span class="line">        $datas =  $table-&gt;listWhere([<span class="string">'table_id'</span> =&gt; $tableId]);</span><br><span class="line">        <span class="comment">// 生成表头</span></span><br><span class="line">        $csv = [];</span><br><span class="line">        $csv[<span class="number">0</span>] = [ <span class="number">0</span> =&gt;<span class="string">'学号'</span>, <span class="number">1</span> =&gt; <span class="string">'姓名'</span>];</span><br><span class="line">        <span class="comment">// 表头ID</span></span><br><span class="line">        $header = [<span class="number">0</span>,<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($fields <span class="keyword">as</span> $id  =&gt; $value) &#123;</span><br><span class="line">            $csv[<span class="number">0</span>][$id] = $value[<span class="string">'name'</span>];</span><br><span class="line">            $header[] = $id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 生成数据</span></span><br><span class="line">        <span class="keyword">foreach</span> ($datas <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $id = count($csv);</span><br><span class="line">            $csv[$id][<span class="number">0</span>]= $data[<span class="string">'student_id'</span>];</span><br><span class="line">            $csv[$id][<span class="number">1</span>]= $data[<span class="string">'name'</span>];</span><br><span class="line">            <span class="keyword">foreach</span> ($data[<span class="string">'data'</span>] <span class="keyword">as</span> $index =&gt; $value) &#123;</span><br><span class="line">                $csv[$id][$index]=$value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $text = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($csv <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $row = [];</span><br><span class="line">            <span class="keyword">foreach</span> ($header <span class="keyword">as</span> $id) &#123;</span><br><span class="line">                $row[] = $data[$id];</span><br><span class="line">            &#125;</span><br><span class="line">            $text .= implode(<span class="string">','</span>, $row) . <span class="string">"\r\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="密码验证版本"><a href="#密码验证版本" class="headerlink" title="密码验证版本"></a>密码验证版本</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">dxkite</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $tables = app()-&gt;getModuleConfig(app()-&gt;getFileModule(<span class="keyword">__FILE__</span>), <span class="string">'statistic'</span>);</span><br><span class="line">        $tableId = $request-&gt;get(<span class="string">'table_id'</span>);</span><br><span class="line">        <span class="comment">// 判断是否存在ID</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId][<span class="string">'password'</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($request-&gt;get(<span class="string">'password'</span>) == $tables[$tableId][<span class="string">'password'</span>]) &#123;</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;download($tableId, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'密码错误'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;download($tableId, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 显示404界面</span></span><br><span class="line">            hook()-&gt;exec(<span class="string">'system:404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">download</span><span class="params">(string $tableId, array $fields)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;exportData($tableId, $fields);</span><br><span class="line">        <span class="comment">// 暂存文件</span></span><br><span class="line">        $path = RUNTIME_DIR .<span class="string">'/'</span>. $tableId .<span class="string">'.csv'</span>;</span><br><span class="line">        storage()-&gt;put($path, $data);</span><br><span class="line">        <span class="comment">// 生成文件下载</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;file($path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exportData</span><span class="params">(string $tableId, array $fields)</span>: <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $table = <span class="keyword">new</span> \dxkite\statistical\table\StatisticTable;</span><br><span class="line">        <span class="comment">// 列出同一个表格</span></span><br><span class="line">        $datas =  $table-&gt;listWhere([<span class="string">'table_id'</span> =&gt; $tableId]);</span><br><span class="line">        <span class="comment">// 生成表头</span></span><br><span class="line">        $csv = [];</span><br><span class="line">        $csv[<span class="number">0</span>] = [ <span class="number">0</span> =&gt;<span class="string">'学号'</span>, <span class="number">1</span> =&gt; <span class="string">'姓名'</span>];</span><br><span class="line">        <span class="comment">// 表头ID</span></span><br><span class="line">        $header = [<span class="number">0</span>,<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($fields <span class="keyword">as</span> $id  =&gt; $value) &#123;</span><br><span class="line">            $csv[<span class="number">0</span>][$id] = $value[<span class="string">'name'</span>];</span><br><span class="line">            $header[] = $id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 生成数据</span></span><br><span class="line">        <span class="keyword">foreach</span> ($datas <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $id = count($csv);</span><br><span class="line">            $csv[$id][<span class="number">0</span>]= $data[<span class="string">'student_id'</span>];</span><br><span class="line">            $csv[$id][<span class="number">1</span>]= $data[<span class="string">'name'</span>];</span><br><span class="line">            <span class="keyword">foreach</span> ($data[<span class="string">'data'</span>] <span class="keyword">as</span> $index =&gt; $value) &#123;</span><br><span class="line">                $csv[$id][$index]=$value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $text = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($csv <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $row = [];</span><br><span class="line">            <span class="keyword">foreach</span> ($header <span class="keyword">as</span> $id) &#123;</span><br><span class="line">                $row[] = $data[$id];</span><br><span class="line">            &#125;</span><br><span class="line">            $text .= implode(<span class="string">','</span>, $row) . <span class="string">"\r\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用密码验证时需要设置密码</p><p><img src="/2018/08/10/Suda-performance-statistics-system/4.png" alt="配置密码"></p><p>你所需要的下载姿势是<br><code>./dev.php/table_id_1/download?password=密码</code></p><h4 id="state-tpl-html"><a href="#state-tpl-html" class="headerlink" title="state.tpl.html"></a><strong>state.tpl.html</strong></h4><p>该页面是为了显示 数据写入信息的<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Action PAGE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">P</span>&gt;</span>&#123;&#123; $:message &#125;&#125;<span class="tag">&lt;/<span class="name">P</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="个人姿势"><a href="#个人姿势" class="headerlink" title="个人姿势"></a>个人姿势</h3><p>为了方便在url传值 我对<code>download.tpl.html</code>、<code>DownloadResponse.php</code>进行了修改<br>新增了：</p><ul><li>输入框输入</li><li>密码提示</li><li>当前输入密码</li></ul><p><img src="/2018/08/10/Suda-performance-statistics-system/5.png" alt="大体图"></p><h4 id="download-tpl-html"><a href="#download-tpl-html" class="headerlink" title="download.tpl.html"></a><strong>download.tpl.html</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Action PAGE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"@u"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line">        Password:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>下载密码: &#123;&#123; $:pwd &#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>你的输入的密码: &#123;&#123; $:ypwd &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>当前情况: &#123;&#123; $:response &#125;&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="DownloadResponse-php-1"><a href="#DownloadResponse-php-1" class="headerlink" title="DownloadResponse.php"></a><strong>DownloadResponse.php</strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">mobenw</span>\<span class="title">statistical</span>\<span class="title">response</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">suda</span>\<span class="title">core</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadResponse</span> <span class="keyword">extends</span> \<span class="title">suda</span>\<span class="title">core</span>\<span class="title">Response</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $tables = app()-&gt;getModuleConfig(app()-&gt;getFileModule(<span class="keyword">__FILE__</span>), <span class="string">'statistic'</span>);</span><br><span class="line">        $tableId = $request-&gt;get(<span class="string">'table_id'</span>);</span><br><span class="line">        <span class="comment">// 判断是否存在ID</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($tables[$tableId][<span class="string">'password'</span>])) &#123;</span><br><span class="line">                <span class="comment">// 显示密码填写界面</span></span><br><span class="line">                $view = <span class="keyword">$this</span>-&gt;page(<span class="string">'download'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//设置页面变量</span></span><br><span class="line">                $view-&gt;set(<span class="string">'pwd'</span>,$tables[$tableId][<span class="string">'password'</span>]);</span><br><span class="line">                $view-&gt;set(<span class="string">'ypwd'</span>,$request-&gt;get(<span class="string">'password'</span>));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ($request-&gt;get(<span class="string">'password'</span>) == $tables[$tableId][<span class="string">'password'</span>]) &#123;</span><br><span class="line">                    $view-&gt;set(<span class="string">'response'</span>,<span class="string">'密码正确，请下载'</span>);</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;download($tableId, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $view-&gt;set(<span class="string">'response'</span>,<span class="string">'密码错误'</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 渲染模板显示出来</span></span><br><span class="line">                $view-&gt;render();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;download($tableId, $tables[$tableId][<span class="string">'fields'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 显示404界面</span></span><br><span class="line">            hook()-&gt;exec(<span class="string">'system:404'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">download</span><span class="params">(string $tableId, array $fields)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;exportData($tableId, $fields);</span><br><span class="line">        <span class="comment">// 暂存文件</span></span><br><span class="line">        $path = RUNTIME_DIR .<span class="string">'/'</span>. $tableId .<span class="string">'.csv'</span>;</span><br><span class="line">        storage()-&gt;put($path, $data);</span><br><span class="line">        <span class="comment">// 生成文件下载</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;file($path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exportData</span><span class="params">(string $tableId, array $fields)</span>: <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $table = <span class="keyword">new</span> \mobenw\statistical\table\StatisticTable;</span><br><span class="line">        <span class="comment">// 列出同一个表格</span></span><br><span class="line">        $datas =  $table-&gt;listWhere([<span class="string">'table_id'</span> =&gt; $tableId]);</span><br><span class="line">        <span class="comment">// 生成表头</span></span><br><span class="line">        $csv = [];</span><br><span class="line">        $csv[<span class="number">0</span>] = [ <span class="number">0</span> =&gt;<span class="string">'学号'</span>, <span class="number">1</span> =&gt; <span class="string">'姓名'</span>];</span><br><span class="line">        <span class="comment">// 表头ID</span></span><br><span class="line">        $header = [<span class="number">0</span>,<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($fields <span class="keyword">as</span> $id  =&gt; $value) &#123;</span><br><span class="line">            $csv[<span class="number">0</span>][$id] = $value[<span class="string">'name'</span>];</span><br><span class="line">            $header[] = $id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 生成数据</span></span><br><span class="line">        <span class="keyword">foreach</span> ($datas <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $id = count($csv);</span><br><span class="line">            $csv[$id][<span class="number">0</span>]= $data[<span class="string">'student_id'</span>];</span><br><span class="line">            $csv[$id][<span class="number">1</span>]= $data[<span class="string">'name'</span>];</span><br><span class="line">            <span class="keyword">foreach</span> ($data[<span class="string">'data'</span>] <span class="keyword">as</span> $index =&gt; $value) &#123;</span><br><span class="line">                $csv[$id][$index]=$value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $text = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($csv <span class="keyword">as</span> $data) &#123;</span><br><span class="line">            $row = [];</span><br><span class="line">            <span class="keyword">foreach</span> ($header <span class="keyword">as</span> $id) &#123;</span><br><span class="line">                $row[] = $data[$id];</span><br><span class="line">            &#125;</span><br><span class="line">            $text .= implode(<span class="string">','</span>, $row) . <span class="string">"\r\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>基本教程应该就是这样了 不对 是心酸历程就是这样了<br>这里附上会长大佬的链接<br><a href="https://dxkite.cn/2018/08/05/suda-results-statistical-design/" target="_blank" rel="noopener">https://dxkite.cn/2018/08/05/suda-results-statistical-design/</a><br><a href="https://dxkite.cn/2018/08/06/suda-results-statistical-router/" target="_blank" rel="noopener">https://dxkite.cn/2018/08/06/suda-results-statistical-router/</a><br><a href="https://dxkite.cn/2018/08/07/suda-results-statistical-data/" target="_blank" rel="noopener">https://dxkite.cn/2018/08/07/suda-results-statistical-data/</a></p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Suda/" rel="tag"><i class="fa fa-tag"></i> Suda</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/08/09/Maybe-your-mobile-phone-might-need-a-Linux/" rel="next" title="或许你的手机上需要一个linux"><i class="fa fa-chevron-left"></i> 或许你的手机上需要一个linux</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/08/12/Suda-apartment-management-system/" rel="prev" title="记一次suda框架之宿舍管理系统">记一次suda框架之宿舍管理系统<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="MoBenw"><p class="site-author-name" itemprop="name">MoBenw</p><p class="site-description motion-element" itemprop="description">一只前往大佬路上的萌新</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/MoBenw" target="_blank" title="GitHub"><i class="fa fa-fw fa-gitHub"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=838922678&site=qq&menu=yes" target="_blank" title="QQ"><i class="fa fa-fw fa-qq"></i> QQ</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.sqlsec.com/" title="国光大佬" target="_blank">国光大佬</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个项目"><span class="nav-number">1.</span> <span class="nav-text">创建一个项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置配置文件"><span class="nav-number">2.</span> <span class="nav-text">设置配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板配置-module-json"><span class="nav-number">2.1.</span> <span class="nav-text">模板配置 module.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用模块-manifast-json"><span class="nav-number">2.2.</span> <span class="nav-text">启用模块 manifast.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表单配置-statistic-json"><span class="nav-number">2.3.</span> <span class="nav-text">表单配置 statistic.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#路由配置-router-json"><span class="nav-number">2.4.</span> <span class="nav-text">路由配置 router.json</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板及响应文件"><span class="nav-number">3.</span> <span class="nav-text">模板及响应文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#StatisticTable-php"><span class="nav-number">3.1.</span> <span class="nav-text">StatisticTable.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-tpl-html"><span class="nav-number">3.2.</span> <span class="nav-text">index.tpl.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TableResponse-php-amp-amp-table-tpl-html"><span class="nav-number">3.3.</span> <span class="nav-text">TableResponse.php &amp;&amp; table.tpl.html</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TableResponse-php"><span class="nav-number">3.3.1.</span> <span class="nav-text">TableResponse.php</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#table-tpl-html"><span class="nav-number">3.3.2.</span> <span class="nav-text">table.tpl.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TableResponse-php-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">TableResponse.php</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TableResponse-php-2"><span class="nav-number">3.3.4.</span> <span class="nav-text">TableResponse.php</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DownloadResponse-php"><span class="nav-number">3.4.</span> <span class="nav-text">DownloadResponse.php</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#非密码版本"><span class="nav-number">3.4.1.</span> <span class="nav-text">非密码版本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#密码验证版本"><span class="nav-number">3.4.2.</span> <span class="nav-text">密码验证版本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#state-tpl-html"><span class="nav-number">3.5.</span> <span class="nav-text">state.tpl.html</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#个人姿势"><span class="nav-number">4.</span> <span class="nav-text">个人姿势</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#download-tpl-html"><span class="nav-number">4.1.</span> <span class="nav-text">download.tpl.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DownloadResponse-php-1"><span class="nav-number">4.2.</span> <span class="nav-text">DownloadResponse.php</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后记"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love" id="heart"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">MoBenw</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 访问人数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-street-view"></i> 总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"d1ce74892a5ce76e19ed",clientSecret:"fcfe33c24d569784237ca7daa2f4f487eabd8e8f",repo:"mobenw.github.io",owner:"MoBenw",admin:["MoBenw"],id:location.pathname,distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script type="text/javascript" src="/js/src/clicklove.js"></script><script type="text/javascript" src="/js/src/crash_cheat.js"></script></body></html>